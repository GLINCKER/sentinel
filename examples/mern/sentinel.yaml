# Sentinel Configuration - MERN Stack
# MongoDB + Express + React + Node.js
#
# Built by Glincker (A GLINR Product)
# https://glincker.com/sentinel

# Global environment variables (applied to all processes)
global_env:
  NODE_ENV: development
  LOG_LEVEL: debug

processes:
  # MongoDB Database
  - name: mongodb
    command: docker
    args:
      - run
      - --rm
      - --name
      - sentinel-mongodb
      - -p
      - "27017:27017"
      - -e
      - MONGO_INITDB_ROOT_USERNAME=admin
      - -e
      - MONGO_INITDB_ROOT_PASSWORD=password
      - mongo:7
    auto_restart: true
    max_restarts: 5
    restart_delay_ms: 3000

  # Express Backend API
  - name: backend
    command: npm
    args:
      - run
      - dev
    cwd: ./server
    env:
      PORT: "8101"
      MONGODB_URI: mongodb://admin:password@localhost:27017/myapp?authSource=admin
      JWT_SECRET: your-secret-key-change-in-production
      CORS_ORIGIN: http://localhost:8100
    depends_on:
      - mongodb
    auto_restart: true
    max_restarts: 3
    restart_delay_ms: 1000
    health_check:
      command: curl
      args:
        - -f
        - http://localhost:8101/api/health
      interval_ms: 10000
      timeout_ms: 5000
      retries: 3

  # React Frontend
  - name: frontend
    command: npm
    args:
      - run
      - dev
    cwd: ./client
    env:
      PORT: "8100"
      REACT_APP_API_URL: http://localhost:8101/api
    depends_on:
      - backend
    auto_restart: true
    max_restarts: 3
    restart_delay_ms: 1000
